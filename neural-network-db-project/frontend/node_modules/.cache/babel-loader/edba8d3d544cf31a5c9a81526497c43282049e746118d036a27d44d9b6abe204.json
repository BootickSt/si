{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport * as authApi from '../services/authApi';\nexport const usePageTracking = pageId => {\n  _s();\n  const location = useLocation();\n  const startTime = useRef(null);\n  const currentPageId = useRef(null);\n  const sendTimeToServer = async (pageId, timeSpent) => {\n    try {\n      await authApi.fetchWithAuth(`http://localhost:8000/kpi/${pageId}/time`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          time_spent: timeSpent\n        })\n      });\n    } catch (error) {\n      console.error('Error sending time data:', error);\n    }\n  };\n  const recordVisit = async pageId => {\n    try {\n      await authApi.fetchWithAuth(`http://localhost:8000/kpi/${pageId}/visit`, {\n        method: 'POST'\n      });\n    } catch (error) {\n      console.error('Error recording visit:', error);\n    }\n  };\n  useEffect(() => {\n    if (pageId && pageId !== currentPageId.current) {\n      recordVisit(pageId);\n      startTime.current = Date.now();\n      currentPageId.current = pageId;\n    }\n    const handleBeforeUnload = () => {\n      if (startTime.current && currentPageId.current) {\n        const endTime = Date.now();\n        const timeSpent = (endTime - startTime.current) / 1000;\n        const data = JSON.stringify({\n          time_spent: timeSpent\n        });\n        navigator.sendBeacon(`http://localhost:8000/kpi/${currentPageId.current}/time`, data);\n      }\n    };\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => {\n      if (startTime.current && currentPageId.current) {\n        const endTime = Date.now();\n        const timeSpent = (endTime - startTime.current) / 1000;\n        sendTimeToServer(currentPageId.current, timeSpent);\n      }\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [location.pathname, pageId]);\n};\n_s(usePageTracking, \"qeNdp8O6LpOITkvXHNqTbP1M6dk=\", false, function () {\n  return [useLocation];\n});","map":{"version":3,"names":["useEffect","useRef","useLocation","authApi","usePageTracking","pageId","_s","location","startTime","currentPageId","sendTimeToServer","timeSpent","fetchWithAuth","method","headers","body","JSON","stringify","time_spent","error","console","recordVisit","current","Date","now","handleBeforeUnload","endTime","data","navigator","sendBeacon","window","addEventListener","removeEventListener","pathname"],"sources":["/home/vladislave/Документы/otd /5/neural-network-db-project/frontend/src/hooks/usePageTracking.js"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport * as authApi from '../services/authApi';\n\nexport const usePageTracking = (pageId) => {\n  const location = useLocation();\n  const startTime = useRef(null);\n  const currentPageId = useRef(null);\n\n  const sendTimeToServer = async (pageId, timeSpent) => {\n    try {\n      await authApi.fetchWithAuth(`http://localhost:8000/kpi/${pageId}/time`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ time_spent: timeSpent }),\n      });\n    } catch (error) {\n      console.error('Error sending time data:', error);\n    }\n  };\n\n  const recordVisit = async (pageId) => {\n    try {\n      await authApi.fetchWithAuth(`http://localhost:8000/kpi/${pageId}/visit`, {\n        method: 'POST',\n      });\n    } catch (error) {\n      console.error('Error recording visit:', error);\n    }\n  };\n\n  useEffect(() => {\n    if (pageId && pageId !== currentPageId.current) {\n      recordVisit(pageId);\n      startTime.current = Date.now();\n      currentPageId.current = pageId;\n    }\n\n    const handleBeforeUnload = () => {\n      if (startTime.current && currentPageId.current) {\n        const endTime = Date.now();\n        const timeSpent = (endTime - startTime.current) / 1000;\n        \n        const data = JSON.stringify({ time_spent: timeSpent });\n        navigator.sendBeacon(\n          `http://localhost:8000/kpi/${currentPageId.current}/time`,\n          data\n        );\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n\n    return () => {\n      if (startTime.current && currentPageId.current) {\n        const endTime = Date.now();\n        const timeSpent = (endTime - startTime.current) / 1000;\n        sendTimeToServer(currentPageId.current, timeSpent);\n      }\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [location.pathname, pageId]);\n};\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,MAAM,QAAQ,OAAO;AACzC,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAO,KAAKC,OAAO,MAAM,qBAAqB;AAE9C,OAAO,MAAMC,eAAe,GAAIC,MAAM,IAAK;EAAAC,EAAA;EACzC,MAAMC,QAAQ,GAAGL,WAAW,CAAC,CAAC;EAC9B,MAAMM,SAAS,GAAGP,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMQ,aAAa,GAAGR,MAAM,CAAC,IAAI,CAAC;EAElC,MAAMS,gBAAgB,GAAG,MAAAA,CAAOL,MAAM,EAAEM,SAAS,KAAK;IACpD,IAAI;MACF,MAAMR,OAAO,CAACS,aAAa,CAAC,6BAA6BP,MAAM,OAAO,EAAE;QACtEQ,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB,CAAC;QACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UAAEC,UAAU,EAAEP;QAAU,CAAC;MAChD,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOQ,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAClD;EACF,CAAC;EAED,MAAME,WAAW,GAAG,MAAOhB,MAAM,IAAK;IACpC,IAAI;MACF,MAAMF,OAAO,CAACS,aAAa,CAAC,6BAA6BP,MAAM,QAAQ,EAAE;QACvEQ,MAAM,EAAE;MACV,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOM,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;IAChD;EACF,CAAC;EAEDnB,SAAS,CAAC,MAAM;IACd,IAAIK,MAAM,IAAIA,MAAM,KAAKI,aAAa,CAACa,OAAO,EAAE;MAC9CD,WAAW,CAAChB,MAAM,CAAC;MACnBG,SAAS,CAACc,OAAO,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;MAC9Bf,aAAa,CAACa,OAAO,GAAGjB,MAAM;IAChC;IAEA,MAAMoB,kBAAkB,GAAGA,CAAA,KAAM;MAC/B,IAAIjB,SAAS,CAACc,OAAO,IAAIb,aAAa,CAACa,OAAO,EAAE;QAC9C,MAAMI,OAAO,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC;QAC1B,MAAMb,SAAS,GAAG,CAACe,OAAO,GAAGlB,SAAS,CAACc,OAAO,IAAI,IAAI;QAEtD,MAAMK,IAAI,GAAGX,IAAI,CAACC,SAAS,CAAC;UAAEC,UAAU,EAAEP;QAAU,CAAC,CAAC;QACtDiB,SAAS,CAACC,UAAU,CAClB,6BAA6BpB,aAAa,CAACa,OAAO,OAAO,EACzDK,IACF,CAAC;MACH;IACF,CAAC;IAEDG,MAAM,CAACC,gBAAgB,CAAC,cAAc,EAAEN,kBAAkB,CAAC;IAE3D,OAAO,MAAM;MACX,IAAIjB,SAAS,CAACc,OAAO,IAAIb,aAAa,CAACa,OAAO,EAAE;QAC9C,MAAMI,OAAO,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC;QAC1B,MAAMb,SAAS,GAAG,CAACe,OAAO,GAAGlB,SAAS,CAACc,OAAO,IAAI,IAAI;QACtDZ,gBAAgB,CAACD,aAAa,CAACa,OAAO,EAAEX,SAAS,CAAC;MACpD;MACAmB,MAAM,CAACE,mBAAmB,CAAC,cAAc,EAAEP,kBAAkB,CAAC;IAChE,CAAC;EACH,CAAC,EAAE,CAAClB,QAAQ,CAAC0B,QAAQ,EAAE5B,MAAM,CAAC,CAAC;AACjC,CAAC;AAACC,EAAA,CA5DWF,eAAe;EAAA,QACTF,WAAW;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}